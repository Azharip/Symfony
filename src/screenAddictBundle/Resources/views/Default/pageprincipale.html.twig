{% extends "screenAddictBundle::layout.html.twig" %}

{% block title %}{{ parent() }} - Page principale{% endblock %}

{% block body %}

	<div>
		<h1 href="{{ path('home')}}">screenAddict</h1>


		<div id="recherche">
			{{ form(rech) }}
		</div>
		<div id="ajax-results"></div>
	</div>

		<div id="leftbodymain">
			<div id="menuRoot">
				{{ app.user.username }}
			</div>
			<div id="menuUser">
				{{ knp_menu_render('screenAddictBundle:Builder:menuUser') }}
			</div>
		</div>

		<div id="bodymain">
			{{ form(mesform)}}
			{% for message in messageList %}
				<div id="posts">
					<p>{{message.content}}</p>
					par : {{message.usernameAuthor}} le {{message.datePost|date("d/m/Y")}}
				</div>
			{% endfor %}
		</div>

		<div id="rightbodymain">
		</div>

	</div>

	<script>
		var list = document.getElementsByTagName("input");
		list[0].onclick = function() {clear1()};
		//list[0].onfocusout = function() {focusout1()};
		list[2].onclick = function() {clear2()};
		list[2].onfocusout = function() {focusout2()};

		var menuRoot = document.getElementById("menuRoot");
		var menuUser = document.getElementById("menuUser");
		var isMenuUserDeployed = false;
		menuUser.style.visibility = "hidden";
		menuRoot.onmousedown = function() {showMenu()};

		function clear1()
		{
			list[0].value="";
		}

		function focusout1()
		{
			list[0].value="Recherchez un film";
		}

		function clear2()
		{
			list[2].value="";
		}

		function focusout2()
		{
			list[2].value="Entrez votre message";
		}

		function showMenu()
		{
			if(!isMenuUserDeployed){
				menuUser.style.visibility = "visible"
				isMenuUserDeployed = true;
			}
			else {
				menuUser.style.visibility = "hidden"
				isMenuUserDeployed = false;
			}
		}

		var motcle = $("form_recherche").value;

		$("#form_recherche").keyup(function(){
            $.ajax({
                url:'{{ (path('rechercher'), {'motcle':motcle}) }}',
                type: "POST",
                dataType: "json",
                data: {"cherche":"test"},
                async: true,
                success: function (data)
                {
					parsedData = JSON.parse(data.output);
					//console.log(parsedData.results.length);
                    //console.log(parsedData.results);
					console.log(parsedData.results[0].title);
					var films = "";
					for(var i = 0; i < parsedData.results.length; i++)
					{
						films += parsedData.results[i].title + "\n";
					}
					$('div#ajax-results').text(films);
                    //$('div#ajax-results').html(data.output);

                }
            });
            return false;

        });
	</script>

{% endblock %}
